<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#2e7d32">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon.svg">
  <link rel="icon" href="icon.svg" type="image/svg+xml">
  <title>Protein Tracker</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --green: #2e7d32;
      --green-light: #4caf50;
      --green-bg: #e8f5e9;
      --gray: #9e9e9e;
      --gray-light: #f5f5f5;
      --text: #212121;
      --text-secondary: #757575;
      --danger: #e53935;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #fafafa;
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0 16px 32px;
      -webkit-tap-highlight-color: transparent;
    }

    header {
      width: 100%;
      max-width: 400px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0 8px;
    }

    header h1 {
      font-size: 20px;
      font-weight: 600;
    }

    #goal-btn {
      background: none;
      border: 1px solid var(--gray);
      border-radius: 20px;
      padding: 4px 12px;
      font-size: 13px;
      color: var(--text-secondary);
      cursor: pointer;
    }

    #goal-btn:active { background: var(--gray-light); }

    .ring-container {
      position: relative;
      width: 200px;
      height: 200px;
      margin: 16px 0 24px;
    }

    .ring-container svg {
      width: 200px;
      height: 200px;
      transform: rotate(-90deg);
    }

    .ring-bg {
      fill: none;
      stroke: var(--green-bg);
      stroke-width: 14;
    }

    .ring-fill {
      fill: none;
      stroke: var(--green-light);
      stroke-width: 14;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.4s ease;
    }

    .ring-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    .ring-text .current {
      font-size: 36px;
      font-weight: 700;
      color: var(--green);
    }

    .ring-text .goal {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .input-row {
      display: flex;
      gap: 8px;
      width: 100%;
      max-width: 400px;
      margin-bottom: 24px;
    }

    .input-row input {
      flex: 1;
      font-size: 20px;
      padding: 14px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      outline: none;
      text-align: center;
      -moz-appearance: textfield;
    }

    .input-row input::-webkit-inner-spin-button,
    .input-row input::-webkit-outer-spin-button {
      -webkit-appearance: none;
    }

    .input-row input:focus { border-color: var(--green-light); }

    .input-row button {
      background: var(--green);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 14px 24px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
    }

    .input-row button:active { background: #1b5e20; }

    .entries-header {
      width: 100%;
      max-width: 400px;
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .entries {
      width: 100%;
      max-width: 400px;
      list-style: none;
    }

    .entries li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: #fff;
      border-radius: 10px;
      margin-bottom: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }

    .entry-info {
      display: flex;
      align-items: baseline;
      gap: 8px;
    }

    .entry-grams {
      font-size: 18px;
      font-weight: 600;
    }

    .entry-time {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .entry-delete {
      background: none;
      border: none;
      color: var(--gray);
      font-size: 20px;
      cursor: pointer;
      padding: 4px 8px;
      line-height: 1;
    }

    .entry-delete:active { color: var(--danger); }

    .empty-state {
      color: var(--text-secondary);
      font-size: 14px;
      text-align: center;
      padding: 24px;
    }

    /* Goal Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      z-index: 100;
      justify-content: center;
      align-items: center;
    }

    .modal-overlay.active { display: flex; }

    .modal {
      background: #fff;
      border-radius: 16px;
      padding: 24px;
      width: 280px;
      text-align: center;
    }

    .modal h2 {
      font-size: 18px;
      margin-bottom: 16px;
    }

    .modal input {
      font-size: 24px;
      width: 120px;
      text-align: center;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      padding: 10px;
      outline: none;
      -moz-appearance: textfield;
    }

    .modal input::-webkit-inner-spin-button,
    .modal input::-webkit-outer-spin-button {
      -webkit-appearance: none;
    }

    .modal input:focus { border-color: var(--green-light); }

    .modal-actions {
      display: flex;
      gap: 8px;
      margin-top: 16px;
      justify-content: center;
    }

    .modal-actions button {
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 15px;
      cursor: pointer;
      border: none;
    }

    .btn-cancel {
      background: var(--gray-light);
      color: var(--text);
    }

    .btn-save {
      background: var(--green);
      color: #fff;
    }
  </style>
</head>
<body>
  <header>
    <h1>Protein Tracker</h1>
    <button id="goal-btn">Ziel: <span id="goal-display">150</span>g</button>
  </header>

  <div class="ring-container">
    <svg viewBox="0 0 200 200">
      <circle class="ring-bg" cx="100" cy="100" r="85"/>
      <circle class="ring-fill" id="ring" cx="100" cy="100" r="85"
        stroke-dasharray="534.07" stroke-dashoffset="534.07"/>
    </svg>
    <div class="ring-text">
      <div class="current" id="current-display">0g</div>
      <div class="goal">von <span id="goal-text">150</span>g</div>
    </div>
  </div>

  <div class="input-row">
    <input type="number" id="protein-input" placeholder="Gramm" inputmode="numeric" min="0">
    <button id="add-btn">+ Hinzufügen</button>
  </div>

  <div class="entries-header" id="entries-header">Heute</div>
  <ul class="entries" id="entries-list"></ul>

  <!-- Goal Modal -->
  <div class="modal-overlay" id="goal-modal">
    <div class="modal">
      <h2>Tagesziel (g)</h2>
      <input type="number" id="goal-input" inputmode="numeric" min="1">
      <div class="modal-actions">
        <button class="btn-cancel" id="modal-cancel">Abbrechen</button>
        <button class="btn-save" id="modal-save">Speichern</button>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'protein-tracker';
    const CIRCUMFERENCE = 2 * Math.PI * 85; // ~534.07

    // --- State ---
    function getToday() {
      return new Date().toISOString().slice(0, 10);
    }

    function loadData() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
      } catch {
        return {};
      }
    }

    function saveData(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function getGoal() {
      return parseInt(localStorage.getItem('protein-goal')) || 150;
    }

    function setGoal(g) {
      localStorage.setItem('protein-goal', String(g));
    }

    function getTodayEntries() {
      const data = loadData();
      return data[getToday()] || [];
    }

    function saveTodayEntries(entries) {
      const data = loadData();
      data[getToday()] = entries;
      saveData(data);
    }

    // --- UI ---
    const ring = document.getElementById('ring');
    const currentDisplay = document.getElementById('current-display');
    const goalText = document.getElementById('goal-text');
    const goalDisplay = document.getElementById('goal-display');
    const entriesList = document.getElementById('entries-list');
    const proteinInput = document.getElementById('protein-input');
    const addBtn = document.getElementById('add-btn');
    const goalBtn = document.getElementById('goal-btn');
    const goalModal = document.getElementById('goal-modal');
    const goalInput = document.getElementById('goal-input');
    const modalCancel = document.getElementById('modal-cancel');
    const modalSave = document.getElementById('modal-save');

    function render() {
      const entries = getTodayEntries();
      const goal = getGoal();
      const total = entries.reduce((sum, e) => sum + e.grams, 0);

      // Ring
      const progress = Math.min(total / goal, 1);
      ring.style.strokeDashoffset = CIRCUMFERENCE * (1 - progress);

      if (total >= goal) {
        ring.style.stroke = '#2e7d32';
      } else {
        ring.style.stroke = '#4caf50';
      }

      // Text
      currentDisplay.textContent = total + 'g';
      goalText.textContent = goal;
      goalDisplay.textContent = goal;

      // Entries list
      if (entries.length === 0) {
        entriesList.innerHTML = '<li class="empty-state">Noch keine Einträge heute</li>';
        return;
      }

      entriesList.innerHTML = '';
      // Show newest first
      for (let i = entries.length - 1; i >= 0; i--) {
        const e = entries[i];
        const li = document.createElement('li');
        li.innerHTML = `
          <div class="entry-info">
            <span class="entry-grams">${e.grams}g</span>
            <span class="entry-time">${e.time}</span>
          </div>
          <button class="entry-delete" data-index="${i}">&times;</button>
        `;
        entriesList.appendChild(li);
      }
    }

    function addEntry() {
      const val = parseInt(proteinInput.value);
      if (!val || val <= 0) return;

      const now = new Date();
      const time = now.getHours().toString().padStart(2, '0') + ':' +
                   now.getMinutes().toString().padStart(2, '0');

      const entries = getTodayEntries();
      entries.push({ grams: val, time: time });
      saveTodayEntries(entries);

      proteinInput.value = '';
      proteinInput.focus();
      render();
    }

    function deleteEntry(index) {
      const entries = getTodayEntries();
      entries.splice(index, 1);
      saveTodayEntries(entries);
      render();
    }

    // --- Events ---
    addBtn.addEventListener('click', addEntry);

    proteinInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') addEntry();
    });

    entriesList.addEventListener('click', (e) => {
      const btn = e.target.closest('.entry-delete');
      if (btn) {
        deleteEntry(parseInt(btn.dataset.index));
      }
    });

    goalBtn.addEventListener('click', () => {
      goalInput.value = getGoal();
      goalModal.classList.add('active');
      goalInput.focus();
      goalInput.select();
    });

    modalCancel.addEventListener('click', () => {
      goalModal.classList.remove('active');
    });

    modalSave.addEventListener('click', () => {
      const val = parseInt(goalInput.value);
      if (val && val > 0) {
        setGoal(val);
        goalModal.classList.remove('active');
        render();
      }
    });

    goalInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') modalSave.click();
    });

    goalModal.addEventListener('click', (e) => {
      if (e.target === goalModal) goalModal.classList.remove('active');
    });

    // --- Service Worker ---
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }

    // --- Init ---
    render();
  </script>
</body>
</html>
